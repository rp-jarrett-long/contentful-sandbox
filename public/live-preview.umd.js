(function(ie){typeof define=="function"&&define.amd?define(ie):ie()})(function(){"use strict";var ie=Object.defineProperty,wt=(r,i,t)=>i in r?ie(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t,p=(r,i,t)=>wt(r,typeof i!="symbol"?i+"":i,t),je={0:8203,1:8204,2:8205,3:8290,4:8291,5:8288,6:65279,7:8289,8:119155,9:119156,a:119157,b:119158,c:119159,d:119160,e:119161,f:119162},Ne={0:8203,1:8204,2:8205,3:65279},Tt=new Array(4).fill(String.fromCodePoint(Ne[0])).join(""),Re="\0",Ot=Object.fromEntries(Object.entries(Ne).map(r=>r.reverse())),Ue=Object.fromEntries(Object.entries(je).map(r=>r.reverse())),It=`${Object.values(je).map(r=>`\\u{${r.toString(16)}}`).join("")}`,Dt=new RegExp(`[${It}]{4,}`,"gu");function At(r){let i=r.match(Dt);if(i)return Ct(i[0],!0)[0]}function Ct(r,i=!1){let t=Array.from(r);if(t.length%2===0){if(t.length%4||!r.startsWith(Tt))return St(t,i)}else throw new Error("Encoded data has invalid length");let o=[];for(let a=t.length*.25;a--;){let l=t.slice(a*4,a*4+4).map(f=>Ot[f.codePointAt(0)]).join("");o.unshift(String.fromCharCode(parseInt(l,4)))}if(i){o.shift();let a=o.indexOf(Re);return a===-1&&(a=o.length),[JSON.parse(o.slice(0,a).join(""))]}return o.join("").split(Re).filter(Boolean).map(a=>JSON.parse(a))}function St(r,i){var t;let o=[];for(let c=r.length*.5;c--;){let d=`${Ue[r[c*2].codePointAt(0)]}${Ue[r[c*2+1].codePointAt(0)]}`;o.unshift(String.fromCharCode(parseInt(d,16)))}let a=[],l=[o.join("")],f=10;for(;l.length;){let c=l.shift();try{if(a.push(JSON.parse(c)),i)return a}catch(d){if(!f--)throw d;let v=+((t=d.message.match(/\sposition\s(\d+)$/))==null?void 0:t[1]);if(!v)throw d;l.unshift(c.substring(0,v),c.substring(v))}}return a}function Mt(r){return At(r)}var me,Pe;function Lt(){if(Pe)return me;Pe=1;var r=Object.prototype.hasOwnProperty,i=Object.prototype.toString;return me=function(t,o,a){if(i.call(o)!=="[object Function]")throw new TypeError("iterator must be a function");var l=t.length;if(l===+l)for(var f=0;f<l;f++)o.call(a,t[f],f,t);else for(var c in t)r.call(t,c)&&o.call(a,t[c],c,t)},me}var be,ze;function jt(){if(ze)return be;ze=1;var r=Lt();be=i;function i(t,o,a){if(arguments.length===3)return i.set(t,o,a);if(arguments.length===2)return i.get(t,o);var l=i.bind(i,t);for(var f in i)i.hasOwnProperty(f)&&(l[f]=i[f].bind(l,t));return l}return i.get=function(t,o){for(var a=Array.isArray(o)?o:i.parse(o),l=0;l<a.length;++l){var f=a[l];if(!(typeof t=="object"&&f in t))throw new Error("Invalid reference token: "+f);t=t[f]}return t},i.set=function(t,o,a){var l=Array.isArray(o)?o:i.parse(o),f=l[0];if(l.length===0)throw Error("Can not set the root object");for(var c=0;c<l.length-1;++c){var d=l[c];typeof d!="string"&&typeof d!="number"&&(d=String(d)),!(d==="__proto__"||d==="constructor"||d==="prototype")&&(d==="-"&&Array.isArray(t)&&(d=t.length),f=l[c+1],d in t||(f.match(/^(\d+|-)$/)?t[d]=[]:t[d]={}),t=t[d])}return f==="-"&&Array.isArray(t)&&(f=t.length),t[f]=a,this},i.remove=function(t,o){var a=Array.isArray(o)?o:i.parse(o),l=a[a.length-1];if(l===void 0)throw new Error('Invalid JSON pointer for remove: "'+o+'"');var f=i.get(t,a.slice(0,-1));if(Array.isArray(f)){var c=+l;if(l===""&&isNaN(c))throw new Error('Invalid array index: "'+l+'"');Array.prototype.splice.call(f,c,1)}else delete f[l]},i.dict=function(t,o){var a={};return i.walk(t,function(l,f){a[f]=l},o),a},i.walk=function(t,o,a){var l=[];a=a||function(f){var c=Object.prototype.toString.call(f);return c==="[object Object]"||c==="[object Array]"},function f(c){r(c,function(d,v){l.push(String(v)),a(d)?f(d):o(d,i.compile(l)),l.pop()})}(t)},i.has=function(t,o){try{i.get(t,o)}catch{return!1}return!0},i.escape=function(t){return t.toString().replace(/~/g,"~0").replace(/\//g,"~1")},i.unescape=function(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")},i.parse=function(t){if(t==="")return[];if(t.charAt(0)!=="/")throw new Error("Invalid JSON pointer: "+t);return t.substring(1).split(/\//).map(i.unescape)},i.compile=function(t){return t.length===0?"":"/"+t.map(i.escape).join("/")},be}jt();const Nt="4.6.20",Rt={version:Nt};let Be=!1;function ke(r){Be=r}const ye=r=>(...i)=>{Be&&console[r](...i)},A={error:ye("error"),warn:ye("warn"),log:ye("log")};function Ut(r,i=500){let t=window.location.href;const o=setInterval(()=>{const a=window.location.href;a!==t&&(t=a,r(a))},i);return()=>clearInterval(o)}const Pt="live-preview-editor",zt="live-preview-sdk";function N(r,i,t){const o={...i,method:r,source:zt,location:window.location.href,version:Rt.version};A.log("Send message",o),t.forEach(a=>{var l;(l=window.top)==null||l.postMessage(o,a)})}function Bt(r,i=100){let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,o)},i)}}function kt(){var r;try{return((r=window.top)==null?void 0:r.location.href)!==window.location.href}catch{return!0}}function Gt(){return`${performance.now()}-${Math.random().toString(36).slice(2)}`}function Ft(r){return typeof r.data!="object"||!r.data?!1:"source"in r.data&&r.data.source===Pt}var oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $t(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var se={exports:{}};se.exports;var Ge;function xt(){return Ge||(Ge=1,function(r,i){var t=200,o="__lodash_hash_undefined__",a=1,l=2,f=9007199254740991,c="[object Arguments]",d="[object Array]",v="[object AsyncFunction]",h="[object Boolean]",I="[object Date]",D="[object Error]",Q="[object Function]",k="[object GeneratorFunction]",V="[object Map]",W="[object Number]",ae="[object Null]",X="[object Object]",Je="[object Promise]",mn="[object Proxy]",Ze="[object RegExp]",le="[object Set]",Xe="[object String]",bn="[object Symbol]",yn="[object Undefined]",we="[object WeakMap]",qe="[object ArrayBuffer]",ce="[object DataView]",_n="[object Float32Array]",wn="[object Float64Array]",Tn="[object Int8Array]",On="[object Int16Array]",In="[object Int32Array]",Dn="[object Uint8Array]",An="[object Uint8ClampedArray]",Cn="[object Uint16Array]",Sn="[object Uint32Array]",Mn=/[\\^$.*+?()[\]{}|]/g,Ln=/^\[object .+?Constructor\]$/,jn=/^(?:0|[1-9]\d*)$/,m={};m[_n]=m[wn]=m[Tn]=m[On]=m[In]=m[Dn]=m[An]=m[Cn]=m[Sn]=!0,m[c]=m[d]=m[qe]=m[h]=m[ce]=m[I]=m[D]=m[Q]=m[V]=m[W]=m[X]=m[Ze]=m[le]=m[Xe]=m[we]=!1;var Qe=typeof oe=="object"&&oe&&oe.Object===Object&&oe,Nn=typeof self=="object"&&self&&self.Object===Object&&self,P=Qe||Nn||Function("return this")(),We=i&&!i.nodeType&&i,et=We&&!0&&r&&!r.nodeType&&r,tt=et&&et.exports===We,Te=tt&&Qe.process,nt=function(){try{return Te&&Te.binding&&Te.binding("util")}catch{}}(),rt=nt&&nt.isTypedArray;function Rn(e,n){for(var s=-1,u=e==null?0:e.length,b=0,g=[];++s<u;){var _=e[s];n(_,s,e)&&(g[b++]=_)}return g}function Un(e,n){for(var s=-1,u=n.length,b=e.length;++s<u;)e[b+s]=n[s];return e}function Pn(e,n){for(var s=-1,u=e==null?0:e.length;++s<u;)if(n(e[s],s,e))return!0;return!1}function zn(e,n){for(var s=-1,u=Array(e);++s<e;)u[s]=n(s);return u}function Bn(e){return function(n){return e(n)}}function kn(e,n){return e.has(n)}function Gn(e,n){return e==null?void 0:e[n]}function Fn(e){var n=-1,s=Array(e.size);return e.forEach(function(u,b){s[++n]=[b,u]}),s}function $n(e,n){return function(s){return e(n(s))}}function xn(e){var n=-1,s=Array(e.size);return e.forEach(function(u){s[++n]=u}),s}var Vn=Array.prototype,Yn=Function.prototype,ue=Object.prototype,Oe=P["__core-js_shared__"],it=Yn.toString,U=ue.hasOwnProperty,ot=function(){var e=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),st=ue.toString,Hn=RegExp("^"+it.call(U).replace(Mn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),at=tt?P.Buffer:void 0,fe=P.Symbol,lt=P.Uint8Array,ct=ue.propertyIsEnumerable,Kn=Vn.splice,Y=fe?fe.toStringTag:void 0,ut=Object.getOwnPropertySymbols,Jn=at?at.isBuffer:void 0,Zn=$n(Object.keys,Object),Ie=q(P,"DataView"),ee=q(P,"Map"),De=q(P,"Promise"),Ae=q(P,"Set"),Ce=q(P,"WeakMap"),te=q(Object,"create"),Xn=J(Ie),qn=J(ee),Qn=J(De),Wn=J(Ae),er=J(Ce),ft=fe?fe.prototype:void 0,Se=ft?ft.valueOf:void 0;function H(e){var n=-1,s=e==null?0:e.length;for(this.clear();++n<s;){var u=e[n];this.set(u[0],u[1])}}function tr(){this.__data__=te?te(null):{},this.size=0}function nr(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}function rr(e){var n=this.__data__;if(te){var s=n[e];return s===o?void 0:s}return U.call(n,e)?n[e]:void 0}function ir(e){var n=this.__data__;return te?n[e]!==void 0:U.call(n,e)}function or(e,n){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=te&&n===void 0?o:n,this}H.prototype.clear=tr,H.prototype.delete=nr,H.prototype.get=rr,H.prototype.has=ir,H.prototype.set=or;function z(e){var n=-1,s=e==null?0:e.length;for(this.clear();++n<s;){var u=e[n];this.set(u[0],u[1])}}function sr(){this.__data__=[],this.size=0}function ar(e){var n=this.__data__,s=he(n,e);if(s<0)return!1;var u=n.length-1;return s==u?n.pop():Kn.call(n,s,1),--this.size,!0}function lr(e){var n=this.__data__,s=he(n,e);return s<0?void 0:n[s][1]}function cr(e){return he(this.__data__,e)>-1}function ur(e,n){var s=this.__data__,u=he(s,e);return u<0?(++this.size,s.push([e,n])):s[u][1]=n,this}z.prototype.clear=sr,z.prototype.delete=ar,z.prototype.get=lr,z.prototype.has=cr,z.prototype.set=ur;function K(e){var n=-1,s=e==null?0:e.length;for(this.clear();++n<s;){var u=e[n];this.set(u[0],u[1])}}function fr(){this.size=0,this.__data__={hash:new H,map:new(ee||z),string:new H}}function dr(e){var n=pe(this,e).delete(e);return this.size-=n?1:0,n}function hr(e){return pe(this,e).get(e)}function pr(e){return pe(this,e).has(e)}function gr(e,n){var s=pe(this,e),u=s.size;return s.set(e,n),this.size+=s.size==u?0:1,this}K.prototype.clear=fr,K.prototype.delete=dr,K.prototype.get=hr,K.prototype.has=pr,K.prototype.set=gr;function de(e){var n=-1,s=e==null?0:e.length;for(this.__data__=new K;++n<s;)this.add(e[n])}function vr(e){return this.__data__.set(e,o),this}function Er(e){return this.__data__.has(e)}de.prototype.add=de.prototype.push=vr,de.prototype.has=Er;function G(e){var n=this.__data__=new z(e);this.size=n.size}function mr(){this.__data__=new z,this.size=0}function br(e){var n=this.__data__,s=n.delete(e);return this.size=n.size,s}function yr(e){return this.__data__.get(e)}function _r(e){return this.__data__.has(e)}function wr(e,n){var s=this.__data__;if(s instanceof z){var u=s.__data__;if(!ee||u.length<t-1)return u.push([e,n]),this.size=++s.size,this;s=this.__data__=new K(u)}return s.set(e,n),this.size=s.size,this}G.prototype.clear=mr,G.prototype.delete=br,G.prototype.get=yr,G.prototype.has=_r,G.prototype.set=wr;function Tr(e,n){var s=ge(e),u=!s&&Br(e),b=!s&&!u&&Me(e),g=!s&&!u&&!b&&yt(e),_=s||u||b||g,w=_?zn(e.length,String):[],T=w.length;for(var y in e)U.call(e,y)&&!(_&&(y=="length"||b&&(y=="offset"||y=="parent")||g&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||Nr(y,T)))&&w.push(y);return w}function he(e,n){for(var s=e.length;s--;)if(vt(e[s][0],n))return s;return-1}function Or(e,n,s){var u=n(e);return ge(e)?u:Un(u,s(e))}function ne(e){return e==null?e===void 0?yn:ae:Y&&Y in Object(e)?Lr(e):zr(e)}function dt(e){return re(e)&&ne(e)==c}function ht(e,n,s,u,b){return e===n?!0:e==null||n==null||!re(e)&&!re(n)?e!==e&&n!==n:Ir(e,n,s,u,ht,b)}function Ir(e,n,s,u,b,g){var _=ge(e),w=ge(n),T=_?d:F(e),y=w?d:F(n);T=T==c?X:T,y=y==c?X:y;var C=T==X,j=y==X,O=T==y;if(O&&Me(e)){if(!Me(n))return!1;_=!0,C=!1}if(O&&!C)return g||(g=new G),_||yt(e)?pt(e,n,s,u,b,g):Sr(e,n,T,s,u,b,g);if(!(s&a)){var M=C&&U.call(e,"__wrapped__"),L=j&&U.call(n,"__wrapped__");if(M||L){var $=M?e.value():e,B=L?n.value():n;return g||(g=new G),b($,B,s,u,g)}}return O?(g||(g=new G),Mr(e,n,s,u,b,g)):!1}function Dr(e){if(!bt(e)||Ur(e))return!1;var n=Et(e)?Hn:Ln;return n.test(J(e))}function Ar(e){return re(e)&&mt(e.length)&&!!m[ne(e)]}function Cr(e){if(!Pr(e))return Zn(e);var n=[];for(var s in Object(e))U.call(e,s)&&s!="constructor"&&n.push(s);return n}function pt(e,n,s,u,b,g){var _=s&a,w=e.length,T=n.length;if(w!=T&&!(_&&T>w))return!1;var y=g.get(e);if(y&&g.get(n))return y==n;var C=-1,j=!0,O=s&l?new de:void 0;for(g.set(e,n),g.set(n,e);++C<w;){var M=e[C],L=n[C];if(u)var $=_?u(L,M,C,n,e,g):u(M,L,C,e,n,g);if($!==void 0){if($)continue;j=!1;break}if(O){if(!Pn(n,function(B,Z){if(!kn(O,Z)&&(M===B||b(M,B,s,u,g)))return O.push(Z)})){j=!1;break}}else if(!(M===L||b(M,L,s,u,g))){j=!1;break}}return g.delete(e),g.delete(n),j}function Sr(e,n,s,u,b,g,_){switch(s){case ce:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case qe:return!(e.byteLength!=n.byteLength||!g(new lt(e),new lt(n)));case h:case I:case W:return vt(+e,+n);case D:return e.name==n.name&&e.message==n.message;case Ze:case Xe:return e==n+"";case V:var w=Fn;case le:var T=u&a;if(w||(w=xn),e.size!=n.size&&!T)return!1;var y=_.get(e);if(y)return y==n;u|=l,_.set(e,n);var C=pt(w(e),w(n),u,b,g,_);return _.delete(e),C;case bn:if(Se)return Se.call(e)==Se.call(n)}return!1}function Mr(e,n,s,u,b,g){var _=s&a,w=gt(e),T=w.length,y=gt(n),C=y.length;if(T!=C&&!_)return!1;for(var j=T;j--;){var O=w[j];if(!(_?O in n:U.call(n,O)))return!1}var M=g.get(e);if(M&&g.get(n))return M==n;var L=!0;g.set(e,n),g.set(n,e);for(var $=_;++j<T;){O=w[j];var B=e[O],Z=n[O];if(u)var _t=_?u(Z,B,O,n,e,g):u(B,Z,O,e,n,g);if(!(_t===void 0?B===Z||b(B,Z,s,u,g):_t)){L=!1;break}$||($=O=="constructor")}if(L&&!$){var ve=e.constructor,Ee=n.constructor;ve!=Ee&&"constructor"in e&&"constructor"in n&&!(typeof ve=="function"&&ve instanceof ve&&typeof Ee=="function"&&Ee instanceof Ee)&&(L=!1)}return g.delete(e),g.delete(n),L}function gt(e){return Or(e,Fr,jr)}function pe(e,n){var s=e.__data__;return Rr(n)?s[typeof n=="string"?"string":"hash"]:s.map}function q(e,n){var s=Gn(e,n);return Dr(s)?s:void 0}function Lr(e){var n=U.call(e,Y),s=e[Y];try{e[Y]=void 0;var u=!0}catch{}var b=st.call(e);return u&&(n?e[Y]=s:delete e[Y]),b}var jr=ut?function(e){return e==null?[]:(e=Object(e),Rn(ut(e),function(n){return ct.call(e,n)}))}:$r,F=ne;(Ie&&F(new Ie(new ArrayBuffer(1)))!=ce||ee&&F(new ee)!=V||De&&F(De.resolve())!=Je||Ae&&F(new Ae)!=le||Ce&&F(new Ce)!=we)&&(F=function(e){var n=ne(e),s=n==X?e.constructor:void 0,u=s?J(s):"";if(u)switch(u){case Xn:return ce;case qn:return V;case Qn:return Je;case Wn:return le;case er:return we}return n});function Nr(e,n){return n=n??f,!!n&&(typeof e=="number"||jn.test(e))&&e>-1&&e%1==0&&e<n}function Rr(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}function Ur(e){return!!ot&&ot in e}function Pr(e){var n=e&&e.constructor,s=typeof n=="function"&&n.prototype||ue;return e===s}function zr(e){return st.call(e)}function J(e){if(e!=null){try{return it.call(e)}catch{}try{return e+""}catch{}}return""}function vt(e,n){return e===n||e!==e&&n!==n}var Br=dt(function(){return arguments}())?dt:function(e){return re(e)&&U.call(e,"callee")&&!ct.call(e,"callee")},ge=Array.isArray;function kr(e){return e!=null&&mt(e.length)&&!Et(e)}var Me=Jn||xr;function Gr(e,n){return ht(e,n)}function Et(e){if(!bt(e))return!1;var n=ne(e);return n==Q||n==k||n==v||n==mn}function mt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=f}function bt(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}function re(e){return e!=null&&typeof e=="object"}var yt=rt?Bn(rt):Ar;function Fr(e){return kr(e)?Tr(e):Cr(e)}function $r(){return[]}function xr(){return!1}r.exports=Gr}(se,se.exports)),se.exports}var Vt=xt();const Yt=$t(Vt);var E=(r=>(r.FIELD_ID="data-contentful-field-id",r.ENTRY_ID="data-contentful-entry-id",r.ASSET_ID="data-contentful-asset-id",r.LOCALE="data-contentful-locale",r.SPACE="data-contentful-space",r.ENVIRONMENT="data-contentful-environment",r))(E||{}),x=(r=>(r.MOUSE_MOVE="MOUSE_MOVE",r.SCROLL_START="SCROLL_START",r.SCROLL_END="SCROLL_END",r.RESIZE_START="RESIZE_START",r.RESIZE_END="RESIZE_END",r.TAGGED_ELEMENTS="TAGGED_ELEMENTS",r.INSPECTOR_MODE_CHANGED="INSPECTOR_MODE_CHANGED",r))(x||{}),Fe={0:8203,1:8204,2:8205,3:8290,4:8291,5:8288,6:65279,7:8289,8:119155,9:119156,a:119157,b:119158,c:119159,d:119160,e:119161,f:119162},$e={0:8203,1:8204,2:8205,3:65279};new Array(4).fill(String.fromCodePoint($e[0])).join(""),Object.fromEntries(Object.entries($e).map(r=>r.reverse())),Object.fromEntries(Object.entries(Fe).map(r=>r.reverse()));var Ht=`${Object.values(Fe).map(r=>`\\u{${r.toString(16)}}`).join("")}`,Kt=new RegExp(`[${Ht}]{4,}`,"gu");const Jt=r=>{if(!r||r.nodeType!==Node.ELEMENT_NODE)return!1;const i=r;return!(!i.hasAttribute(E.FIELD_ID)||!i.hasAttribute(E.ENTRY_ID)&&!i.hasAttribute(E.ASSET_ID))};function Zt(r,i){if(!Jt(r))return null;const t={fieldId:r.getAttribute(E.FIELD_ID),locale:r.getAttribute(E.LOCALE)??i.locale,environment:r.getAttribute(E.ENVIRONMENT)??i.environment,space:r.getAttribute(E.SPACE)??i.space,manuallyTagged:!0};if(!t.fieldId)return A.warn("Element is missing field ID attribute and cannot be tagged",{id:r.getAttribute(E.ENTRY_ID)??r.getAttribute(E.ASSET_ID),sharedProps:t}),null;const o=r.getAttribute(E.ENTRY_ID);if(o)return{...t,entryId:o};const a=r.getAttribute(E.ASSET_ID);return a?{...t,assetId:a}:null}function xe(r,i){return r.href===i.href}function Xt(r,i){return!(!xe(r.sourceMap,i.sourceMap)||r.element!==i.element)}function qt(r){let i=[];return typeof r.matches=="function"&&r.matches("*")&&(i=[r]),[...i,...Array.from(r.querySelectorAll("*:not(script,style,meta,title)"))].map(t=>({node:t,text:Qt(t)})).filter(({text:t})=>!!(t&&t.match(Kt)))}function Qt(r){return r.matches("input[type=submit], input[type=button], input[type=reset]")?r.value:r.matches("img, video")?r.alt:Array.from(r.childNodes).filter(i=>i.nodeType===Node.TEXT_NODE&&!!i.textContent).map(i=>i.textContent).join("")}function Wt(r,i){for(const t of i)if(t.element===r||t.element.contains(r))return!0;return!1}function _e({root:r=window.document,options:i}){const t=[...i.ignoreManuallyTaggedElements?[]:r.querySelectorAll(`[${E.ASSET_ID}][${E.FIELD_ID}], [${E.ENTRY_ID}][${E.FIELD_ID}]`)].map(c=>({element:c,attributes:Zt(c,i)})).filter(({attributes:c})=>c!==null),o=[],a=qt("body"in r?r.body:r);for(const{node:c,text:d}of a){const v=Mt(d);if(!v||!v.origin.includes("contentful.com")){A.warn("Element has missing or invalid ContentSourceMap, please check if you have correctly enabled ContentSourceMaps and that the element's data originates from Contentful",{node:c,sourceMap:v});continue}if(!(Wt(c,t)||o.some(h=>h.element.contains(c)&&xe(h.sourceMap,v)))){if(c.matches("img")){const h=c.closest("figure")||c.closest("picture")||c;o.push({element:h,sourceMap:v});continue}o.push({element:c,sourceMap:v})}}const l=o.filter((c,d)=>o.findIndex(v=>Xt(c,v))===d);for(const{element:c,sourceMap:d}of l){let v=null;if(d.href){const h=on(d.href);if(!h)continue;if(h.entityType==="Asset")v={fieldId:h.fieldId,locale:h.locale,space:h.space,environment:h.environment,assetId:h.entityId};else if(h.entityType==="Entry")v={fieldId:h.fieldId,locale:h.locale,space:h.space,environment:h.environment,entryId:h.entityId};else{A.warn("Unknown entityType",{element:c,sourceMap:d});continue}}else if(d.contentful&&sn(d.contentful)){const h=d.contentful;if(!h.entity||!h.field||!h.locale||!h.space||!h.environment){A.warn("Element has missing information in their ContentSourceMap, please check if you have restricted the platform for the encoding. (Missing parameters in `contentful`)",{element:c,sourceMap:d});continue}const I={fieldId:h.field,locale:h.locale,space:h.space,environment:h.environment};if(h.entityType==="Asset")I.assetId=h.entity,v=I;else if(h.entityType==="Entry")I.entryId=h.entity,v=I;else{A.warn("Unknown entityType in contentful data",{element:c,sourceMap:d});continue}}else{A.warn("Element has neither href nor contentful data in their ContentSourceMap, unable to extract attributes.",{element:c,sourceMap:d});continue}t.push({element:c,attributes:v})}const f=t.filter(({attributes:c})=>(c==null?void 0:c.manuallyTagged)===!1||!(c!=null&&c.manuallyTagged)).length;return{taggedElements:t,manuallyTaggedCount:t.length-f,automaticallyTaggedCount:f,autoTaggedElements:l}}function Ve({options:r}){return[...new Set(_e({options:r}).taggedElements.map(i=>i.attributes&&"entryId"in i.attributes?i.attributes.entryId:null).filter(Boolean))]}const en=(r,i,t=window.document)=>{const{top:o,right:a,bottom:l,left:f}=i,c=t.elementFromPoint(f+1,o+1),d=t.elementFromPoint(a-1,o+1),v=t.elementFromPoint(f+1,l-1),h=t.elementFromPoint(a-1,l-1);return!(c===r&&d===r&&v===r&&h===r)},tn=(r,i=window.document)=>r.map(t=>({...t,isVisible:t.element.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}),isCoveredByOtherElement:en(t.element,t.coordinates,i)})),nn=r=>r.map(({element:i,attributes:t})=>({element:i,coordinates:i.getBoundingClientRect(),attributes:t})),rn=(r,i=window.document)=>{const t=nn(r);return tn(t,i)};function on(r){try{const i=new URL(r),t=i.searchParams.get("focusedField"),o=i.searchParams.get("focusedLocale"),a=i.pathname.split("/").filter(Boolean),l=a.indexOf("spaces"),f=a.indexOf("environments"),c=l!==-1?a[l+1]:void 0,d=f!==-1?a[f+1]:void 0;let v,h;const I=a.indexOf("entries"),D=a.indexOf("assets");return I!==-1?(v="Entry",h=a[I+1]):D!==-1&&(v="Asset",h=a[D+1]),!v||!h?(console.warn("Unable to determine entityType or entityId from href",{href:r}),null):t?o?!c||!d?(console.warn("Missing space or environment in href path",{href:r}),null):{entityId:h,entityType:v,fieldId:t,locale:o,space:c,environment:d}:(console.warn("Missing focusedLocale query parameter in href",{href:r}),null):(console.warn("Missing focusedField query parameter in href",{href:r}),null)}catch(i){return console.warn("Invalid href URL",{href:r,error:i}),null}}function sn(r){return r&&typeof r.entity=="string"&&typeof r.field=="string"&&typeof r.locale=="string"&&typeof r.space=="string"&&typeof r.environment=="string"&&(r.entityType==="Asset"||r.entityType==="Entry")}class an{constructor(i){p(this,"delay",300),p(this,"isScrolling",!1),p(this,"scrollTimeout"),p(this,"isResizing",!1),p(this,"resizeTimeout"),p(this,"hoveredElement"),p(this,"taggedElements",[]),p(this,"manuallyTaggedCount",0),p(this,"automaticallyTaggedCount",0),p(this,"intersectionObserver"),p(this,"observersCB",[]),p(this,"cleanupCB",[]),p(this,"init",()=>{this.cleanupCB=[this.addScrollListener(),this.addMutationListener(document.body),this.addResizeListener(),this.addHoverListener()],this.updateElements()}),p(this,"cleanup",()=>{this.observersCB.forEach(t=>t()),this.cleanupCB.forEach(t=>t())}),p(this,"receiveMessage",t=>{if(t.method===x.INSPECTOR_MODE_CHANGED){const{isInspectorActive:o}=t;o?this.init():this.cleanup()}}),p(this,"observe",t=>{this.intersectionObserver.observe(t);const o=this.addMutationListener(t);this.observersCB.push(o,()=>this.intersectionObserver.unobserve(t))}),p(this,"addScrollListener",()=>{const{targetOrigin:t}=this.options,o=()=>{this.isScrolling||(this.isScrolling=!0,N(x.SCROLL_START,{},t)),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.isScrolling=!1,N(x.SCROLL_END,{},t),this.updateElements()},this.delay)},a={capture:!0,passive:!0};return window.addEventListener("scroll",o,a),()=>window.removeEventListener("scroll",o,a)}),p(this,"addMutationListener",t=>{const o=new MutationObserver(()=>{this.updateElements()});return o.observe(t,{characterData:!0,attributes:!0,attributeFilter:[E.ENTRY_ID,E.FIELD_ID,E.LOCALE,E.SPACE,E.ENVIRONMENT,"class","style"],childList:!0,subtree:!0}),()=>o.disconnect()}),p(this,"addResizeListener",()=>{const{targetOrigin:t}=this.options,o=new ResizeObserver(()=>{this.isResizing||(this.isResizing=!0,N(x.RESIZE_START,{},t)),this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.isResizing=!1,N(x.RESIZE_END,{},t),this.updateElements()},this.delay)});return o.observe(document.body),()=>o.disconnect()}),p(this,"addHoverListener",()=>{const t=Bt(a=>{let l;for(const f of a){const c=f;if(c.nodeName==="BODY")break;const d=this.taggedElements.find(v=>v.element===c);if(d){l=d;break}}this.hoveredElement=l==null?void 0:l.element,this.updateElements()},this.delay),o=a=>{t(a.composedPath())};return window.addEventListener("mouseover",o,{passive:!0}),()=>window.removeEventListener("mouseover",o)}),p(this,"sendTaggedElements",()=>{N(x.TAGGED_ELEMENTS,{elements:this.taggedElements.map(t=>({coordinates:t.coordinates,isVisible:!!t.isVisible,attributes:t.attributes,isHovered:this.hoveredElement===t.element,isCoveredByOtherElement:!!t.isCoveredByOtherElement})),automaticallyTaggedCount:this.automaticallyTaggedCount,manuallyTaggedCount:this.manuallyTaggedCount},this.options.targetOrigin)}),p(this,"updateElements",()=>{const{taggedElements:t,manuallyTaggedCount:o,automaticallyTaggedCount:a}=_e({options:this.options}),l=rn(t);Yt(l,this.taggedElements)||(this.observersCB.forEach(f=>f()),this.observersCB=[],this.taggedElements=l,t.forEach(({element:f})=>this.observe(f)),this.manuallyTaggedCount=o,this.automaticallyTaggedCount=a)}),this.options=i,this.intersectionObserver=new IntersectionObserver(t=>{const o=this.taggedElements;for(const a of t)if(a.isIntersecting)for(const l of o)l.element===a.target&&(l.coordinates=a.intersectionRect,l.isVisible=a.target.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}));this.taggedElements=o,this.sendTaggedElements()},{threshold:.15})}}const{stringify:ln}=JSON,cn=String,un="string",fn="object",dn=(r,i)=>i,Ye=(r,i,t)=>{const o=cn(i.push(t)-1);return r.set(t,o),o},hn=(r,i,t)=>{const o=dn,a=new Map,l=[],f=[];let c=+Ye(a,l,o.call({"":r},"",r)),d=!c;for(;c<l.length;)d=!0,f[c]=ln(l[c++],v,t);return"["+f.join(",")+"]";function v(h,I){if(d)return d=!d,I;const D=o.call(this,h,I);switch(typeof D){case fn:if(D===null)return D;case un:return a.get(D)||Ye(a,l,D)}return D}};var R=(r=>(r.CONNECTED="CONNECTED",r.DISCONNECTED="DISCONNECTED",r.ERROR="ERROR",r.TAGGED_FIELD_CLICKED="TAGGED_FIELD_CLICKED",r.URL_CHANGED="URL_CHANGED",r.SUBSCRIBED="SUBSCRIBED",r.UNSUBSCRIBED="UNSUBSCRIBED",r.ENTRY_UPDATED="ENTRY_UPDATED",r.ENTRY_SAVED="ENTRY_SAVED",r.DEBUG_MODE_ENABLED="DEBUG_MODE_ENABLED",r))(R||{});function pn(r,i){N("TAGGED_FIELD_CLICKED",{action:"TAGGED_FIELD_CLICKED",...r},i)}function gn(r,i){N("TAGGED_FIELD_CLICKED",{action:"TAGGED_FIELD_CLICKED",...r},i)}class vn{constructor({locale:i,targetOrigin:t}){p(this,"subscriptions",new Map),p(this,"defaultLocale"),p(this,"sendMessage"),this.defaultLocale=i,this.sendMessage=(o,a)=>N(o,a,t)}async receiveMessage(i){if(i.method===R.ENTRY_UPDATED){const{data:t,subscriptionId:o}=i,a=this.subscriptions.get(o);a?(a.callback(t),a.data=t,this.subscriptions.set(o,a)):A.error("Received an update for an unknown subscription",{subscriptionId:o,data:t,subscriptions:this.subscriptions})}}subscribe(i){const t=Gt(),o=i.locale??this.defaultLocale;this.subscriptions.set(t,{...i});const a={locale:o,event:"edit",id:t,config:hn(i)};return this.sendMessage(R.SUBSCRIBED,a),()=>{this.sendMessage(R.UNSUBSCRIBED,a),this.subscriptions.delete(t)}}}class En{constructor({locale:i,options:t,inspectorModeEnabled:o}){p(this,"locale"),p(this,"options"),p(this,"inspectorModeEnabled"),p(this,"subscription"),this.locale=i,this.options=t,this.inspectorModeEnabled=o}subscribe(i){return this.subscription&&A.log("There is already a subscription for the save event, the existing one will be replaced."),this.subscription=i,()=>{this.subscription=void 0}}receiveMessage(i){if(i.method===R.ENTRY_SAVED&&this.subscription){const{entity:t}=i;this.inspectorModeEnabled?Ve({options:this.options}).includes(t.sys.id)&&this.subscription(t):this.subscription(t)}}}const He=["https://app.contentful.com","https://app.eu.contentful.com","http://localhost:3001"],S=class Le{static init(i){var t;if(typeof i!="object"||!(i!=null&&i.locale))throw new Error("Init function has to be called with a locale configuration (for example: `ContentfulLivePreview.init({ locale: 'en-US'})`)");const{debugMode:o,enableInspectorMode:a,enableLiveUpdates:l,locale:f,environment:c,space:d,targetOrigin:v}=i;if(typeof window<"u"){if(!kt())return this.liveUpdatesEnabled=!1,Promise.resolve(null);if(o&&ke(o),typeof a=="boolean"&&(this.inspectorModeEnabled=a),typeof l=="boolean"&&(this.liveUpdatesEnabled=l),this.locale=f,this.space=d,this.environment=c,this.initTargetOrigin(v),this.initialized)return A.log("You have already initialized the Live Preview SDK."),Promise.resolve(Le.inspectorMode);this.inspectorModeEnabled&&(this.inspectorMode=new an({locale:f,space:d,environment:c,targetOrigin:this.targetOrigin,ignoreManuallyTaggedElements:(t=i.experimental)==null?void 0:t.ignoreManuallyTaggedElements})),this.liveUpdatesEnabled&&(this.liveUpdates=new vn({locale:f,targetOrigin:this.targetOrigin}),this.saveEvent=new En({locale:f,options:{locale:this.locale,space:this.space,environment:this.environment,targetOrigin:this.targetOrigin},inspectorModeEnabled:this.inspectorModeEnabled})),window.addEventListener("message",k=>{var V,W,ae;if(Ft(k)){if(A.log("Received message",k.data),k.data.method===R.DEBUG_MODE_ENABLED){ke(!0);return}this.inspectorModeEnabled&&((V=this.inspectorMode)==null||V.receiveMessage(k.data)),this.liveUpdatesEnabled&&((W=this.liveUpdates)==null||W.receiveMessage(k.data),(ae=this.saveEvent)==null||ae.receiveMessage(k.data))}}),Ut(()=>{N(R.URL_CHANGED,{action:R.URL_CHANGED,taggedElementCount:document.querySelectorAll(`[${E.ENTRY_ID}]`).length},this.targetOrigin)});const{taggedElements:h,manuallyTaggedCount:I,automaticallyTaggedCount:D}=this.inspectorModeEnabled?_e({options:{locale:this.locale,space:this.space,environment:this.environment}}):{taggedElements:[],manuallyTaggedCount:0,automaticallyTaggedCount:0},Q=h.length;return N(R.CONNECTED,{action:R.CONNECTED,connected:!0,tags:Q,taggedElementCount:Q,locale:this.locale,isInspectorEnabled:this.inspectorModeEnabled,isLiveUpdatesEnabled:this.liveUpdatesEnabled,manuallyTaggedElementCount:I,automaticallyTaggedElementCount:D},this.targetOrigin),this.initialized=!0,Promise.resolve(Le.inspectorMode)}}static initTargetOrigin(i){if(i)this.targetOrigin=Array.isArray(i)?i:[i];else{const t=window.location.ancestorOrigins,o=t?He.find(a=>t.contains(a)):He.find(a=>document.referrer.includes(a));if(!o)throw new Error("The current origin is not supported. Please provide a targetOrigin in the live preview configuration.");this.targetOrigin=[o]}}static subscribe(i,t){if(!this.liveUpdatesEnabled)return()=>{};const o=typeof i=="string"?i:"edit",a=typeof i=="object"?i:t;if(o==="save"){if(!this.saveEvent)throw new Error("Save event is not initialized, please call `ContentfulLivePreview.init()` first.");return this.saveEvent.subscribe(a.callback)}if(!this.liveUpdates)throw new Error("Live updates are not initialized, please call `ContentfulLivePreview.init()` first.");return this.liveUpdates.subscribe(a)}static getProps(i){const{fieldId:t,locale:o,environment:a,space:l}=i;if(!this.inspectorModeEnabled)return null;if(t){const f={...o?{[E.LOCALE]:o}:{},...a?{[E.ENVIRONMENT]:a}:{},...l?{[E.SPACE]:l}:{},[E.FIELD_ID]:t};if(o&&(f[E.LOCALE]=o),i.assetId!==void 0)return{...f,[E.ASSET_ID]:i.assetId};if(i.entryId!==void 0)return{...f,[E.ENTRY_ID]:i.entryId}}return A.warn("Missing property for inspector mode",{...i}),null}static toggleInspectorMode(){return this.inspectorModeEnabled=!this.inspectorModeEnabled,this.inspectorModeEnabled}static toggleLiveUpdatesMode(){return this.liveUpdatesEnabled=!this.liveUpdatesEnabled,this.liveUpdatesEnabled}static openEntryInEditor(i){const t={locale:this.locale,environment:this.environment,space:this.space};if(i.assetId!==void 0&&i.fieldId){gn({...t,...i},this.targetOrigin);return}if(i.entryId!==void 0&&i.fieldId){pn({...t,...i},this.targetOrigin);return}A.error("Please provide field id and entry/asset id to openEntryInEditor.",{...i})}static getEntryList(){return Ve({options:{locale:this.locale,space:this.space,environment:this.environment}})}};p(S,"initialized",!1),p(S,"inspectorMode",null),p(S,"liveUpdates",null),p(S,"saveEvent",null),p(S,"inspectorModeEnabled",!0),p(S,"liveUpdatesEnabled",!0),p(S,"locale"),p(S,"space"),p(S,"environment"),p(S,"sendMessage"),p(S,"targetOrigin");let Ke=S;Ke.init({locale:"en-US",debugMode:!0,enableLiveUpdates:!0}),Ke.subscribe("save",{callback:async()=>{const r=window.location.pathname;await fetch(`/api/revalidate?pathname=${r}`),window.location.reload()}})});
